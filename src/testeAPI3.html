<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Teste API Google Places</title>
  </head>
  <body>
    <div id="reviews"></div>

    <script
      src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAd4U5ETE1wjqnXCVxoMBtx8Ez4Y2QBOUo&libraries=places"
      async
    ></script>

    <script>
      function initMap() {
        var place_id = 'ChIJa0crJO1XzpQRAzqpq0Hg69Y'
        var request = {
          placeId: place_id,
          fields: ['name', 'rating', 'reviews']
        }

        var service = new google.maps.places.PlacesService(
          document.createElement('div')
        )

        service.getDetails(request, function (place, status) {
          if (status == google.maps.places.PlacesServiceStatus.OK) {
            var reviews = place.reviews
            if (reviews) {
              var sorted_reviews = reviews.sort(function (a, b) {
                return new Date(b.time) - new Date(a.time)
              })

              var recent_reviews = sorted_reviews.slice(0, 5)

              recent_reviews.forEach(function (review) {
                var html = `
                  <div class="review">
                    <div class="rating">${review.rating} estrelas</div>
                    <div class="text">${review.text}</div>
                  </div>
                `

                document.getElementById('reviews').innerHTML += html
              })
            } else {
              document.getElementById('reviews').innerHTML =
                'Não foi possível obter avaliações.'
            }
          } else {
            document.getElementById('reviews').innerHTML =
              'Não foi possível obter avaliações.'
          }
        })
      }
    </script>
  </body>
</html>
